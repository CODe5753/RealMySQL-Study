# 쿼리 힌트

MySQL에서 사용 가능한 힌트는 두 가지다.

- 인덱스 힌트
- 옵티마이저 힌트

옵티마이저 힌트는 MySQL 5.6부터 새롭게 추가됐다.

## 9.4.1 인덱스 힌트

인덱스 힌트는 SELECT와 UPDATE 명령에만 사용할 수 있다.

### 9.4.1.1 STRAIGHT JOIN

여러 개의 테이블이 조인되는 경우 조인 순서를 고정하는 역할을 한다.

옵티마이저가 그때그때 각 테이블의 통계 정보와 쿼리의 조건을 기반으로 가장 최적이라고 판단되는 순서로 조인한다.

```mysql

EXPLAIN
SELECT *
FROM employees e, dept_emp de, departments d
WHERE e.emp_no=de.emp_no AND d.dept_no=de.dept_no;

```

실행 계획을 보면 departments 테이블을 드라이빙 테이블로 선택했다.

일반적으로 조인을 하기 위한 컬럼들의 인덱스 여부로 조인의 순서가 결정되며, 조인 컬럼의 인덱스에 아무런 문제가 없는 경우엔 **레코드가 적은 테이블을 드라이빙으로 선택**한다.

하지만 이 쿼리의 조인 순서를 변경하려면 STRAIGHT_JOIN 힌트를 사용할 수 있다.

``` mysql

SELECT STRAIGHT_JOIN
 e.first_name, e.last_name, d.dept_name
FROM employees e, dept_emp de, departments d
WHERE e.emp_no=de.emp_no
  AND d.dept_no=de.dept_no;

SELECT /*! STRAIGHT_JOIN */
  e.first_name, e.last_name, d.dept_name
FROM employees e, dept_emp de, departments d
WHERE e.emp_no = de.emp_no
  AND d.dept_no = de.dept_no;

```

FROM 절에 명시된 테이블의 순서대로 emp -> dept_emp -> dept 조인을 수행한다는 것을 알 수 있다.

주로 다음 기준에 맞게 조인 순서가 결정되지 않는 경우에만 STRAIGHT_JOIN 힌트로 조인 순서를 조정하는 것이 좋다.

- 임시 테이블과 일반 테이블의 조인: 일반적으로 임시 테이블을 드라이빙 테이블로 선정하는 것이 좋다. 옵티마이저가 실행 계획을 제대로 수립하지 못해서 심각한 성능 저하가 있는 경우에는 힌트를 사용하면 된다.
- 임시 테이블끼리 조인: 임시 테이블은 항상 인덱스가 없기 때문에 어느 테이블을 먼저 드라이빙으로 읽어도 무관하므로 크기가 작은 테이블을 드라이빙으로 선택해주는 것이 좋다
- 양쪽 테이블 모두 조인 컬럼에 인덱스가 있거나, 없는 경우엔 레코드 건수가 적은 테이블을 드라이빙으로 선택해주는 것이 좋으며 **그 이외의 경우엔 조인 컬럼에 인덱스가 없는 테이블을 드라이빙으로 선택하는 것이 좋다.**

여기서 말한 레코드 건수는 인덱스를 사용할 수 있는 WHERE 조건까지 포함해 그 조건을 만족하는 레코드 건수를 의미하는 것이다.

아래와 같은 경우엔 STRAIGHT_JOIN 힌트를 이용해 employees 테이블을 드라이빙되게 하는 것이 좋다.

```mysql

SELECT /*! STRAIGHT_JOIN */
  e.first_name, e.last_name, d.dept_name
FROM employees e, departments d, dept_emp de
WHERE e.emp_no = de.emp_no
AND d.dept_no = de.dept_no
AND e.emp_no=10001;

```

STRAIGHT_JOIN 힌트와 비슷한 역할을 하는 옵티마이저 힌트로는 다음과 같은 것들이 있다.

- JOIN_FIXED_ORDER
- JOIN_ORDER
- JOIN_PREFIX
- JOIN_SUFFIX

### 9.4.1.2 USE INDEX / FORCE INDEX / IGNORE INDEX

조인 순서 변경하는 것 다음으로 자주 사용되는 것이 인덱스 힌트인데, STRAIGHT JOIN 힌트와는 달리 인덱스 힌트는 사용하려는 인덱스를 가지는 테이블 뒤에 힌트를 명시해야 한다.

